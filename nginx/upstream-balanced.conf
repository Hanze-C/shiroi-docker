# Upstream configuration for load balancing between blue and green
# Both containers serve traffic simultaneously

upstream shiroi_backend {
  # Blue container
  server shiroi-app-blue:2323 weight=1 max_fails=3 fail_timeout=30s;

  # Green container
  server shiroi-app-green:2323 weight=1 max_fails=3 fail_timeout=30s;

  # Load balancing method
  # Default is round-robin, you can also use:
  # ip_hash;           # Session affinity based on client IP
  # least_conn;        # Route to server with least connections
  # fair;              # Route based on response time (requires nginx-upstream-fair module)

  # Connection pooling
  keepalive 32;
  keepalive_requests 100;
  keepalive_timeout 60s;
}